# CI/CD Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                         DEVELOPER WORKFLOW                          │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │   Git Push/PR         │
                    │   (GitHub)            │
                    └───────────┬───────────┘
                                │
                                ▼
        ┌───────────────────────────────────────────────┐
        │           GITHUB ACTIONS PIPELINE             │
        └───────────────────────────────────────────────┘
                                │
        ┌───────────────────────┴───────────────────────┐
        │                                               │
        ▼                                               ▼
┌───────────────┐                              ┌───────────────┐
│  STAGE 1:     │                              │  STAGE 2:     │
│  LINT & QA    │                              │  UNIT TESTS   │
├───────────────┤                              ├───────────────┤
│ • Black       │                              │ • Pytest      │
│ • Flake8      │                              │ • Coverage    │
│ • MyPy        │                              │ • Upload      │
└───────┬───────┘                              └───────┬───────┘
        │                                              │
        └──────────────────┬───────────────────────────┘
                           │
                           ▼
                ┌──────────────────┐
                │   STAGE 3:       │
                │   BUILD DOCKER   │
                ├──────────────────┤
                │ • Build image    │
                │ • Push to GHCR   │
                │ • Tag versions   │
                └────────┬─────────┘
                         │
         ┌───────────────┴───────────────┐
         │                               │
         ▼                               ▼
┌──────────────────┐           ┌──────────────────┐
│  STAGE 4:        │           │  STAGE 5:        │
│  INTEGRATION     │           │  SECURITY SCAN   │
├──────────────────┤           ├──────────────────┤
│ • Start compose  │           │ • Trivy scan     │
│ • Test DAGs      │           │ • Bandit check   │
│ • Health checks  │           │ • Upload SARIF   │
└────────┬─────────┘           └────────┬─────────┘
         │                              │
         └──────────┬───────────────────┘
                    │
                    ▼
         ┌─────────────────────┐
         │ BRANCH = develop/*? │
         └──────────┬──────────┘
                    │
         ┌──────────┴──────────┐
         │ YES               NO│
         ▼                     ▼
┌────────────────┐      ┌────────────┐
│  STAGE 6:      │      │   SKIP     │
│  DEPLOY        │      │            │
│  STAGING       │      └────────────┘
├────────────────┤
│ • Auto deploy  │
│ • No approval  │
└────────────────┘
                    
                    ▼
         ┌─────────────────────┐
         │  BRANCH = main?     │
         └──────────┬──────────┘
                    │
         ┌──────────┴──────────┐
         │ YES               NO│
         ▼                     ▼
┌────────────────┐      ┌────────────┐
│  STAGE 7:      │      │   DONE     │
│  DEPLOY        │      │            │
│  PRODUCTION    │      └────────────┘
├────────────────┤
│ • Manual       │
│   approval     │
│ • Create       │
│   release      │
└────────┬───────┘
         │
         ▼
┌────────────────┐
│  STAGE 8:      │
│  NOTIFY        │
├────────────────┤
│ • Email alert  │
│ • Archive logs │
└────────────────┘


═══════════════════════════════════════════════════════════════

                    DEPLOYMENT FLOW

┌─────────────────────────────────────────────────────────────┐
│                      DOCKER IMAGES                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
        ┌─────────────────────────────────────┐
        │   GitHub Container Registry         │
        │   (ghcr.io/<owner>/<repo>)         │
        ├─────────────────────────────────────┤
        │ Tags:                               │
        │ • latest (from main)                │
        │ • develop-0.0.4 (from develop)     │
        │ • sha-abc1234 (every commit)       │
        │ • v1.2.3 (releases)                │
        └────────────┬────────────────────────┘
                     │
         ┌───────────┴────────────┐
         │                        │
         ▼                        ▼
┌────────────────┐      ┌────────────────┐
│   STAGING      │      │  PRODUCTION    │
│   Environment  │      │  Environment   │
├────────────────┤      ├────────────────┤
│ • AWS/GCP/K8s  │      │ • AWS/GCP/K8s  │
│ • Auto-deploy  │      │ • Manual       │
│ • develop tag  │      │ • latest tag   │
└────────────────┘      └────────────────┘


═══════════════════════════════════════════════════════════════

                    MONITORING FLOW

┌─────────────────────────────────────────────────────────────┐
│                    PIPELINE RUNS                            │
└─────────────────────────────────────────────────────────────┘
                              │
         ┌────────────────────┼────────────────────┐
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  GitHub Actions │  │    Codecov      │  │  GitHub         │
│  Dashboard      │  │    Coverage     │  │  Security       │
├─────────────────┤  ├─────────────────┤  ├─────────────────┤
│ • Build status  │  │ • % coverage    │  │ • Trivy alerts  │
│ • Job logs      │  │ • Trend graphs  │  │ • Bandit alerts │
│ • Artifacts     │  │ • PR comments   │  │ • Dependencies  │
└─────────────────┘  └─────────────────┘  └─────────────────┘
         │                    │                    │
         └────────────────────┼────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │  Email          │
                    │  Notifications  │
                    ├─────────────────┤
                    │ ✅ Build pass   │
                    │ ❌ Build fail   │
                    │ 🚀 Deployed     │
                    └─────────────────┘


═══════════════════════════════════════════════════════════════

                SCHEDULED PIPELINE TEST

    ┌────────────────────────────────────────┐
    │  CRON: Daily at 2 AM UTC              │
    └───────────────┬────────────────────────┘
                    │
                    ▼
         ┌────────────────────┐
         │ Start Docker       │
         │ Compose Stack      │
         └──────────┬─────────┘
                    │
                    ▼
         ┌────────────────────┐
         │ Trigger DAG        │
         │ (brewery_pipeline) │
         └──────────┬─────────┘
                    │
                    ▼
         ┌────────────────────┐
         │ Wait for           │
         │ Completion         │
         │ (max 20 min)       │
         └──────────┬─────────┘
                    │
                    ▼
         ┌────────────────────┐
         │ Verify Outputs     │
         │ • Bronze data      │
         │ • Silver parquet   │
         │ • Gold CSV/JSON    │
         └──────────┬─────────┘
                    │
         ┌──────────┴───────────┐
         │ SUCCESS         FAIL │
         ▼                      ▼
┌─────────────────┐    ┌─────────────────┐
│ Export logs     │    │ Export logs     │
│ Archive         │    │ Send alert      │
│ artifacts       │    │ to team         │
└─────────────────┘    └─────────────────┘
```
